---
title: 管理任务序列
titleSuffix: Configuration Manager
description: 创建、编辑、部署、导入和导出任务序列，在环境中管理任务并自动执行任务。
ms.custom: na
ms.date: 03/22/2018
ms.prod: configuration-manager
ms.reviewer: nac
ms.suite: na
ms.technology:
- configmgr-osd
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: a1f099f1-e9b5-4189-88b3-f53e3b4e4add
caps.latest.revision: 10
author: aczechowski
ms.author: aaroncz
manager: angrobe
ms.openlocfilehash: 262bfa3991bbd95fad779da9520358d527a42b07
ms.sourcegitcommit: a19e12d5c3198764901d44f4df7c60eb542e765f
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/28/2018
---
# <a name="manage-task-sequences-to-automate-tasks-in-system-center-configuration-manager"></a>管理任务序列以在 System Center Configuration Manager 中自动执行任务

*适用范围：System Center Configuration Manager (Current Branch)*

使用任务序列在 Configuration Manager 环境中自动执行步骤。 这些步骤可将 OS 映像部署到目标计算机，通过一组 OS 安装文件生成和捕获 OS 映像，并捕获和还原用户状态信息。 任务序列位于 Configuration Manager 控制台中。 在“软件库”工作区中，展开“操作系统”，选择“任务序列”。 将“任务序列”节点（包括所创建的子文件夹）复制到整个 Configuration Manager 层次结构。 有关计划的信息，请参阅[计划自动执行任务时的考虑事项](../plan-design/planning-considerations-for-automating-tasks.md)。  

 使用下列部分来管理任务序列。

##  <a name="BKMK_CreateTaskSequence"></a>创建任务序列  
 通过使用创建任务序列向导来创建任务序列。 此向导可创建下列类型的任务序列：  

|任务序列类型|更多信息|  
|------------------------|----------------------|  
|[用于安装操作系统的任务序列](create-a-task-sequence-to-install-an-operating-system.md)|此任务序列类型创建用于安装 OS 的步骤以及用于迁移用户数据、包括软件更新和安装应用程序的选项。|  
|[用于升级操作系统的任务序列](create-a-task-sequence-to-upgrade-an-operating-system.md)|此任务序列类型创建用于升级 OS 的步骤以及用于包括软件更新和安装应用程序的选项。|  
|[用于捕获操作系统的任务序列](create-a-task-sequence-to-capture-an-operating-system.md)|此任务序列类型创建从引用计算机构建和捕获 OS 的步骤。 在映像被捕获之前，可以在引用计算机上包括软件更新和安装应用程序。|  
|[用于捕获和还原用户状态的任务序列](create-a-task-sequence-to-capture-and-restore-user-state.md)|此任务序列提供要添加到现有任务序列以捕获和还原用户状态数据的步骤。|  
|[自定义任务序列](create-a-custom-task-sequence.md)|此任务序列类型不会添加任何步骤到任务序列。 创建任务序列后，编辑任务序列并向其添加步骤。|  



## <a name="return-to-previous-page-when-a-task-sequence-fails"></a>任务序列失败时返回上一页
运行任务序列出现故障时，可以返回到上一页面。 在以前版本的 Configuration Manager 中，出现故障时必须重启任务序列。 在以下应用场景中使用“上一页”按钮：

- 当计算机在 Windows PE 中启动时，任务序列可用之前可能会先显示任务序列启动对话框。 在此应用场景中单击“下一步”时，会显示任务序列的最后一页，同时显示一条消息告知无可用的任务序列。 现在，可单击“上一页”以再次搜索可用任务序列。 在出现可用任务序列之前，可重复此过程。
- 运行任务序列但分发点上尚无可用从属内容包时，任务序列会失败。 如果缺少的内容未尚未分发，请立即将其分发。 或等待分发点提供该内容。 然后单击“上一页”，让任务序列再次搜索该内容。

##  <a name="BKMK_ModifyTaskSequence"></a>编辑任务序列  
 可以通过添加或删除步骤、添加或删除组或者更改步骤的顺序来修改任务序列。 使用以下过程修改现有任务序列：  

> [!IMPORTANT]  
>  编辑使用创建任务序列向导创建的任务序列时，步骤的名称可能是步骤的操作或类型。 例如，可能会看到名为“分区磁盘 0”的步骤，该名称是类型为[格式化磁盘并分区](../understand/task-sequence-steps.md#BKMK_FormatandPartitionDisk)的步骤的操作。 所有任务序列步骤均按其类型记录，并不一定按编辑器中显示的步骤的名称记录。  

#### <a name="to-edit-a-task-sequence"></a>编辑任务序列  

1.  在 Configuration Manager 控制台中，单击“软件库”。  

2.  在“软件库”工作区中，展开“操作系统”，然后单击“任务序列”。  

3.  在“任务序列”列表中，选择要编辑的任务序列。  

4.  在“主页”选项卡上的“任务序列”组中，单击“编辑”，然后执行任何以下操作：  

    -   要添加任务序列步骤，请单击“添加”，选择步骤类型，然后单击要添加的步骤。 例如，若要添加“运行命令行”步骤，可单击“添加”，选择“常规”，然后单击“运行命令行”。  

         有关所有任务序列步骤及其类型的列表，请参阅此过程后面的表。  

    -   要向任务序列中添加组，请单击“添加”，然后单击“新建组”。 添加组后，可以向组中添加步骤。  

    -   要更改任务序列中步骤和组的顺序，请选择要重新排序的步骤或组，然后使用“上移项目”或“下移项目”图标。 一次只能移动一个步骤或组。  

    -   要删除步骤或组，请选择该步骤或组并单击“删除”。  

5.  单击“确定”以保存更改。  

 有关可用的任务序列步骤列表，请参阅[任务序列步骤](../understand/task-sequence-steps.md)。  

## <a name="configure-software-center-properties"></a>配置软件中心属性
使用以下过程配置软件中心中显示的任务序列的详细信息。 这些详细信息仅供参考。  
1. 在 Configuration Manager 工作区中，转到“软件库”工作区，展开“操作系统”，选择“任务序列”。
2. 选择要编辑的任务序列，然后单击“属性”。
3. 在“常规”选项卡上，可使用软件中心的以下设置：
  - **需要重启**：让用户了解安装期间是否需要重新启动。
  - **下载大小 (MB)**：指定任务序列在软件中心中显示多少兆字节。  
  - **预计运行时间(分钟)**：指定任务序列在软件中心中显示的预计运行时间（以分钟为单位）。

## <a name="configure-advanced-task-sequence-settings"></a>配置高级任务序列设置
使用以下过程配置软件中心中显示的任务序列的详细信息。 这些详细信息仅供参考。  
1. 在 Configuration Manager 工作区中，转到“软件库”工作区，展开“操作系统”，选择“任务序列”。
2. 选择要编辑的任务序列，然后单击“属性”。
3. 在“高级”选项卡上，有下列可用设置：

    - 首先运行其他程序    
    选中此复选框，可在此任务序列之前运行其他程序（其他包中）。 默认情况下，此复选框已清除。 您指定要首先运行的程序不需要单独播发。

        > [!IMPORTANT]     
        此设置仅适用于在完整 OS 中运行的任务序列。 如果使用 PXE 或启动媒体启动任务序列，则 Configuration Manager 将忽略此设置。

    - 包     
        当选择“首先运行其他程序”时，请浏览查找包含必须在此任务序列之前运行的程序的包。

    - 程序     
    当选择“首先运行其他程序”时，请从“程序”下拉列表中选择必须在此任务序列之前运行的程序。

        > [!NOTE]    
        > 如果所选程序在客户端上运行失败，则任务序列不会运行。 如果所选程序成功运行，则它不会再次运行，即使在同一客户端上重新运行了任务序列。
 
    - 在部署此任务序列的计算机上禁用该任务序列    
    如果选择此选项时，则会暂时禁用包含此任务序列的所有部署。 任务序列从可运行部署的列表中删除。 再次启用前它不会运行。 默认情况下，此选项已被清除。

    - 最大允许运行时间    
    指定预计任务序列在目标计算机上运行的最长时间（分钟）。 使用等于或大于零的整数。 默认情况下，此值设置为 120 分钟。

        > [!IMPORTANT]    
        > 当使用此任务序列运行的维护时段进行收集时，如果“最大允许运行时间” 大于计划的维护时段，就可能出现冲突。 如果最大运行时间设置为 0，任务序列将在维护时段启动。 维护时段关闭后，它将继续运行，直到完成或失败。 因此，最大运行时间设置为“0”的任务序列可能运行到维护时段结束后。 如果将最大运行时间设置为具体时段（不为“0”），且此时段大于任何可用维护时段的长度，那么该任务序列不会运行。 有关详细信息，请参阅[如何使用维护时段](/sccm/core/clients/manage/collections/use-maintenance-windows)。
 
        如果值设置为“0”，则 Configuration Manager 会将最大允许运行时间计算为 12 小时（720 分钟）以监视进度。 但是，只要倒计时持续时间不超过维护时段值，任务序列便会启动。

    > [!NOTE]    
    > 达到最大运行时间时，如果 Configuration Manager 设置为“使用管理权限运行”且未选择“允许用户与此程序交互”设置，它就会停止任务序列。 如果任务序列本身未停止，则达到最大允许运行时间后，Configuration Manager 将停止监视任务序列。 

    - 使用启动映像   
        启用此选项后，可在运行任务序列时使用选定的启动映像。 

        单击“浏览”，可选择其他启动映像。 清除此选项，可在运行任务序列时禁用选定的启动映像。

    - 此任务序列可以在任何平台上运行     
        如果你选择此选项，则 Configuration Manager 在任务序列部署时不会检查目标计算机的平台类型。 默认情况下选择此选项。

    - 此任务序列仅可以在指定的客户端平台上运行    
        此选项指定此任务序列可以在其上运行的处理器、OS 版本和服务包。 选择此选项时，还必须从列表中至少选择一个平台。 默认情况下不选择任何平台。 Configuration Manager 在评估集合中的哪些目标计算机将接收部署的任务序列时，使用此信息。

        > [!NOTE]    
        > 当从启动媒体或通过 PXE 启动运行任务序列时，此选项会被忽略，即使选中了“此程序可以在任何平台上运行”选项，该任务序列也将运行。



## <a name="configure-high-impact-task-sequence-settings"></a>配置影响重大的任务序列设置
可以将任务序列设置为“影响重大”，并自定义用户在运行任务序列时收到的消息。

### <a name="set-a-task-sequence-as-a-high-impact-task-sequence"></a>将任务序列设置为影响重大的任务序列
使用下列过程将任务序列设置为“影响重大”。
> [!NOTE]    
> 任何符合特定条件的任务序列都将自动定义为“影响重大”。 有关详细信息，请参阅[管理高风险部署](/sccm/protect/understand/settings-to-manage-high-risk-deployments)。

1. 在 Configuration Manager 工作区中，转到“软件库”工作区，展开“操作系统”，选择“任务序列”。
2. 选择要编辑的任务序列，然后单击“属性”。
3. 在“用户通知”选项卡上，选择“这是影响重大的任务序列”。

### <a name="create-a-custom-notification-for-high-risk-deployments"></a>创建高风险部署的自定义通知
使用以下过程为影响重大的部署创建自定义通知。
1. 在 Configuration Manager 工作区中，转到“软件库”工作区，展开“操作系统”，选择“任务序列”。
2. 选择要编辑的任务序列，然后单击“属性”。
3. 在“用户通知”选项卡上，选择“使用自定义文本”。
>  [!NOTE]    
>  只能在已选择“这是影响重大的任务序列”时设置用户通知文本。

4. 配置下列设置（每个文本框最多 255 个字符）：

  **用户通知标题文本**：指定在软件中心用户通知上显示的蓝色文本。 例如，在默认用户通知中，本部分包含“确认想要升级此计算机上的操作系统”。

  **用户通知消息文本**：三个文本框提供自定义通知的正文。 所有文本框都需要添加文本。
  - 第一个文本框：指定文本的主要正文，通常包含针对用户的说明。 例如，在默认用户通知中，本部分包含“操作系统升级需要一些时间，并且计算机可能会多次重启”。
  - 第二个文本框：指定文本主要正文下的粗体文本。 例如，在默认用户通知中，本部分包含“此就地升级将安装新的操作系统并自动迁移你的应用、数据和设置”。
  - 第三个文本框：指定粗体文本下的最后一行文本。 例如，在默认用户通知中，本部分包含“单击‘安装’以开始。 否则，单击‘取消’”的内容。   
    
假设在属性中配置以下自定义通知。

![任务序列属性的自定义“用户通知”选项卡](..\media\user-notification.png)

当最终用户从软件中心打开安装时，将显示以下通知消息。

![软件中心中面向最终用户的自定义任务序列通知](..\media\user-notification-enduser.png)


##  <a name="BKMK_DistributeTS"></a>分发任务序列引用的内容  
 在客户端运行引用内容的任务序列之前，必须将该内容分发到分发点。 你可以随时选择任务序列并分发其内容，以便为分发建立一个新的引用包列表。 如果使用更新的内容更改任务序列，在内容可供客户端使用之前必须重新分发此内容。 使用以下过程来分发任务序列引用的内容。  

#### <a name="to-distribute-referenced-content-to-distribution-points"></a>将引用的内容分发到分发点  

1.  在 Configuration Manager 控制台中，单击“软件库”。  

2.  在“软件库”工作区中，展开“操作系统”，然后单击“任务序列”。  

3.  在“任务序列”列表中，选择要分发的任务序列。  

4.  在“主页”选项卡上的“部署”组中，单击“分发内容”，以启动分发内容向导。  

5.  在“常规”页上，验证是否为分发选择了正确的任务序列。 然后单击 **“下一步”**。  

6.  在“内容”页上，验证要分发的内容（例如任务序列引用的启动映像），然后单击“下一步”。  

7.  在“内容目标”页上，指定要在其中分发任务序列内容的集合、分发点或分发点组。 然后单击 **“下一步”**。  

    > [!IMPORTANT]  
    >  如果所选任务序列引用已分发到特定分发点的内容，则向导不会列出该分发点。  

8.  完成向导。  

 可以预留任务序列中引用的内容。 Configuration Manager 创建压缩的预安排内容文件，该文件包含所选内容的文件、关联依赖项和关联元数据。 然后，你可以在站点服务器、辅助站点或分发点中手动导入内容。 有关如何预留内容文件的详细信息，请参阅[预留内容](../../core/servers/deploy/configure/deploy-and-manage-content.md#bkmk_prestage)。  



##  <a name="BKMK_DeployTS"></a>部署任务序列  
 使用以下过程将任务序列部署到集合中的计算机。  

> [!WARNING]  
>  你可以管理高风险任务序列部署的行为。 高风险部署是自动安装、可能产生意外结果的部署。 例如，部署目的为“必需”且部署 OS 的任务序列被认为是高风险部署。 有关详细信息，请参阅[用于管理高风险部署的设置](../../protect/understand/settings-to-manage-high-risk-deployments.md)。  

> [!NOTE]  
>  任务序列部署的状态消息显示在主站点上的“消息”窗口中，但不会显示在管理中心站点上。  

#### <a name="to-deploy-a-task-sequence"></a>部署任务序列    

1.  在 Configuration Manager 控制台中，单击“软件库”。  

2.  在“软件库”工作区中，展开“操作系统”，然后单击“任务序列”。  

3.  在“任务序列”列表中，选择要部署的任务序列。  

4.  在“主页”选项卡上的“部署”组中，单击“部署”。  

    > [!NOTE]  
    >  如果“部署”不可用，则任务序列有无效的引用。 纠正该引用，然后再次尝试部署任务序列。  

5.  在“常规”页上，指定以下信息，然后单击“下一步”。  

    -   任务序列：指定想要部署的任务序列。 默认情况下，此框显示所选的任务序列。  

    -   **集合**：指定包含要运行任务序列的计算机的集合。  

         不要部署将 OS 安装到不适合的集合（例如“所有系统”集合）的任务序列。 请确保所选集合仅包含要运行任务序列的那些计算机。  

        > [!NOTE]  
        >  部署高风险部署（例如 OS）时，“选择集合”窗口将仅显示满足在站点属性中配置的部署验证设置的自定义集合。 高风险部署始终局限于自定义集合、你所创建的集合和内置“未知计算机”集合。 创建高风险部署时，无法选择“所有系统”等内置集合。 取消选中“隐藏成员数大于站点最低大小配置的集合”以查看所含客户端少于配置的最大大小的全部自定义集合。 有关详细信息，请参阅[用于管理高风险部署的设置](../../protect/understand/settings-to-manage-high-risk-deployments.md)。  
        >   
        >  部署验证设置基于集合的当前成员身份。 部署任务序列后，不重新评估高风险部署设置的集合成员身份。  
        >   
        >  例如，假设将“默认大小”设置为 100，将“最大大小”设置为 1000。 创建高风险部署时，“选择集合”窗口仅显示包含的客户端少于 100 个的集合。 如果清除“隐藏成员数大于站点最低大小配置的集合”设置，则该窗口显示包含的客户端少于 1000 个的集合。  
        >   
        >  选择包含站点角色的集合时，以下行为适用：  
        >   
        >  -   如果集合包含站点系统服务器，而你将部署验证设置配置为阻止具有站点系统服务器的集合，则会出现错误。 你将无法继续创建部署。  
        > -   如果以下一项标准适用，则部署软件向导将显示高风险警告。 继续操作需要同意创建高风险部署。 站点会生成审核状态消息。
        >     - 如果集合包含站点系统服务器，而你将部署验证设置配置为对具有站点系统服务器的集合发出警告
        >     - 如果集合超过默认大小值
        >     - 如果集合包含服务器  

    -   备注（可选）：指定描述此任务序列部署的其他信息。  
    - **选择部署模板**：从 Configuration Manager 1802 版开始，<!--1357391-->可以为任务序列保存和指定部署模板。     

         > [!IMPORTANT]
         > 在 Configuration Manager 1802 版中，某些项目未保存在模板中。  <!--510610--> 确保在运行部署向导时应用以下各项：
         > - 软件安装 
         > - 计划 
         > - 预下载内容
 
6.  在“部署设置”页上，指定以下信息，然后单击“下一步”。  

    -   目的：从下拉列表中，选择以下选项之一：  

        -   可用：如果将任务序列部署到用户，则用户将在应用程序目录中看到发布的任务序列，并可根据需要请求该任务序列。 如果将任务序列部署到设备，则用户会在软件中心看到该任务序列，并可根据需要进行安装。  

        -   必需：依据配置的计划自动部署任务序列。 如果任务序列未隐藏，则用户仍可以跟踪其部署状态。 用户还可在截止时间前使用软件中心安装任务序列。  

    -   无论用户是否登录都根据计划自动部署：在部署任务序列时，此选项不可用。  

    -   **发送唤醒数据包**：如果将部署目的设置为“必需”，并选择此选项，则站点会在运行部署前向计算机发送一个唤醒数据包。 此数据包可在到达安装截止时间时将计算机从休眠中唤醒。 必须针对“LAN 唤醒”配置计算机和网络，然后才能使用此选项。  

    -   **允许客户端使用按流量计费的 Internet 连接在安装截止时间之后下载内容，这可能会导致附加成本**：如果你的任务序列安装应用程序但不部署 OS，则可以指定是否允许客户端在安装截止时间之后下载内容（如果客户端使用按流量计费的 Internet 连接）。 Internet 提供商有时根据你在按流量计费的 Internet 连接上发送和接收的数据量计费。  

        > [!NOTE]  
        >  虽然使用按流量计费的 Internet 连接可能对不部署 OS 的任务序列有效，但不支持这种连接。  

    -   如果用户请求此应用程序，则需要管理员批准：在部署任务序列时，此选项不可用。  

    -   可用于以下项目：指定任务序列是否可用于 Configuration Manager 客户端、媒体或者 PXE。  

        > [!IMPORTANT]  
        >  将“仅媒体和 PXE (隐藏)”设置用于自动化任务序列部署。 要让计算机在无用户干预的情况下自动启动到该部署，请选择“允许无人参与的操作系统部署”，并将 SMSTSPreferredAdvertID 变量设置为媒体的一部分。 有关任务序列变量的详细信息，请参阅[任务序列内置变量](../understand/task-sequence-built-in-variables.md)  

7.  在“计划”页上，指定以下信息，然后单击“下一步”。  

    > [!IMPORTANT]  
    >  Windows PE 客户端从 PXE 或启动媒体启动时，客户端不会评估部署计划（启动、过期或截止时间）。 仅部署从完整的 Windows OS 启动的客户端部署中的计划。 请考虑使用其他方法（例如维护窗口）来控制部署到从 Windows PE 启动的客户端的活动任务序列。  

    -   计划此部署将在何时变为可用：指定任务序列在目标计算机上可以运行的日期和时间。 如果选中“UTC”复选框，则此设置可以确保任务序列按照目标计算机上的本地时间同时（而不是在不同时间）可用于多个目标计算机。  

         如果启动时间早于所需时间，则客户端会在你指定的启动时间下载任务序列。  

    -   计划此部署将在何时过期：指定任务序列在目标计算机上过期的日期和时间。 如果选中“UTC”复选框，则此设置可以确保任务序列按照目标计算机上的本地时间同时（而不是在不同时间）在多个目标计算机上到期。  

    -   分配计划：指定在目标计算机上运行所需任务序列的时间。 你可以添加多个计划。  

         你可以指定计划的开始日期和时间、任务序列是每周、每月还是按自定义的间隔运行，以及在诸如登录或注销计算机之类的事件之后任务序列是否运行。  

        > [!NOTE]  
        >  如果计划的所需任务序列的开始时间早于任务序列的可用日期和时间，则 Configuration Manager 客户端在计划的开始时间下载任务序列，即使任务序列在更早时间可用也不例外。  

    -   重新运行行为：指定重新运行任务序列的时间。 可以指定以下选项之一：  

        -   **从不重新运行已部署的程序**：如果客户端之前已运行了任务序列，则它不会重新运行。 即使任务序列最初失败或者任务序列文件已更改，此任务序列也不会重新运行。  

        -   始终重新运行程序：计划部署时始终在客户端上重新运行任务序列，即使以前成功运行了任务序列也不例外。 如果使用在其中例行更新任务序列的定期部署，则此设置非常有用。  

            > [!IMPORTANT]  
            >  虽然默认情况下设置了此选项，但在你分配所需部署之前，它不会产生影响。 用户始终可以重新运行可用的部署。  

        -   如果上次尝试失败则重新运行：只有在以前未成功运行任务序列的情况下，才在计划部署时重新运行任务序列。 此设置对必需部署非常有用。 如果上次运行尝试失败，它们会根据分配计划自动尝试重新运行。  

        -   如果上次尝试成功则重新运行：只有当以前在客户端上成功运行了任务序列时才重新运行任务序列。 如果你使用在其中例行更新任务序列的定期部署，并且每个更新都要求成功安装以前的更新，则此设置很有用。  

        > [!NOTE]  
        >  因为用户可以重新运行可用的任务序列部署，所以请确保在生产环境中部署可用的任务序列之前仔细进行评估，并测试用户多次重新运行任务序列会出现什么情况。  

8.  在“用户体验”页上，指定以下信息，然后单击“下一步”。  

    -   允许用户独立于分配运行程序：指定是否允许用户独立于部署分配运行所需的任务序列。  

    -   显示任务序列进度：指定 Configuration Manager 客户端是否显示任务序列的进度。  

    -   **软件安装**：指定在计划的时间之后是否允许用户在已配置的维护时段之外安装软件。  

    -   系统重新启动（如果要求完成安装）：指定是否允许用户在晚于分配时间的已配置维护时段之外安装软件后重启计算机。  

    -   **允许任务序列针对 Internet 上的客户端运行**：指定是否允许在基于 Internet 的客户端上运行任务序列。 此设置不支持安装软件（如 OS）的操作。 请将此选项仅用于在标准 OS 中执行操作的基于通用脚本的任务序列。  

         - 从 1802 版开始，此设置支持通过云管理网关从 Windows 10 就地升级任务序列部署到基于 Internet 的客户端。 有关详细信息，请参阅[通过 CMG 部署 Windows 10 就地升级](#deploy-windows-10-in-place-upgrade-via-cmg)。    

9. 在“警报”页上，为此任务序列部署指定所需的警报设置，然后单击“下一步”。  

10. 在“分发点”页上，指定以下信息，然后单击“下一步”。  

    -   部署选项：指定下列选项之一：  

        > [!NOTE]  
        >  如果使用多播部署 OS，则必须在需要时或者在运行任务序列之前将内容下载到目标计算机。  

        -   指定客户端在任务序列需要内容时从分发点将内容下载到目标计算机。  

        -   指定客户端在运行任务序列之前从分发点将所有内容下载到目标计算机。 如果已指定任务序列可用于 PXE 和启动媒体部署，则“部署设置”页不会显示此选项。  

        -   指定客户端从分发点运行内容。 只有当与任务序列关联的所有包都能够使用分发点上的包共享时才可以使用此选项。 要使内容能够使用包共享，请参阅每个包的“属性”中的“数据访问”选项卡。  

    -   在没有本地分发点可用的情况下使用远程分发点：指定客户端是否可以使用慢速和不可靠网络上的分发点来下载任务序列所需的内容。  
11. 从 Configuration Manager 1802 开始，如果希望保存设置以便再次使用，可单击“摘要”选项卡上的“另存为模板”。 为模板提供名称，然后选择要保存的设置。 

 
12. 完成向导。  


### <a name="deploy-windows-10-in-place-upgrade-via-cmg"></a>通过 CMG 部署 Windows 10 就地升级
<!-- 1357149 -->

从 1802 版开始，Windows 10 就地升级任务序列支持部署到通过[云管理网关](/sccm/core/clients/manage/plan-cloud-management-gateway) (CMG) 托管的基于 Internet 的客户端。 此功能可让远程用户更轻松地升级到 Windows 10，无需连接 Intranet。 

确保就地升级任务序列引用的所有内容均分发到[云分发点](/sccm/core/plan-design/hierarchy/use-a-cloud-based-distribution-point)。 否则设备无法运行任务序列。

在部署升级任务序列时，请使用以下设置：
- 部署“用户体验”选项卡上的“允许任务序列针对 Internet 上的客户端运行”。
- 部署“分发点”选项卡上的“启动任务序列之前本地下载所有内容”。 其他选项如“运行中任务序列需要时，从本地下载内容”在此方案中不起作用。 任务序列引擎当前无法从云分发点获取内容。 启动任务序列之前，Configuration Manager 客户端必须从云分发点下载内容。
- （可选）部署“常规”选项卡上的“此任务序列的预下载内容”。 有关详细信息，请参阅[配置预缓存内容](/sccm/osd/deploy-use/create-a-task-sequence-to-upgrade-an-operating-system#configure-pre-cache-content)。



##  <a name="BKMK_ExportImport"></a>导出和导入任务序列  
 可以导出和导入任务序列（包含或不包含相关对象）。 该引用内容包括 OS 映像、启动映像、客户端代理包、驱动程序包以及具有依赖项的应用程序。  

 导出和导入任务序列时，请考虑下列各项。  

-   不会导出任务序列中存储的密码。 如果导出和导入包含密码的任务序列，则必须编辑导入的任务序列，并重新输入任何密码。 请确保为[加入域或工作组](../understand/task-sequence-steps.md#BKMK_JoinDomainorWorkgroup)、[连接到网络文件夹](../understand/task-sequence-steps.md#BKMK_ConnectToNetworkFolder)和[运行命令行](../understand/task-sequence-steps.md#BKMK_RunCommandLine)操作指定密码。  

- 使用“设置动态变量”步骤导出任务序列时，将不会为配置了“机密值”设置的变量导出值。 导入任务序列后，请重新输入这些变量的值。

-   作为一种最佳方案，如果你具有多个主站点，请在管理中心站点导入任务序列。  

 使用下列步骤导出和导入任务序列。  

#### <a name="to-export-task-sequences"></a>导出任务序列  

1.  在 Configuration Manager 控制台中，单击“软件库”。  

2.  在“软件库”工作区中，展开“操作系统”，然后单击“任务序列”。  

3.  在“任务序列”列表中，选择要导出的任务序列。 如果选择多个任务序列，则会将它们存储在一个导出文件上。  

4.  在“主页”选项卡上的“任务序列”组中，单击“导出”，以启动导出任务序列向导。  

5.  在“常规”页上，指定以下设置，然后单击“下一步”。  

    -   在“文件”框中，指定导出文件的位置和名称。 如果直接输入文件名，请确保在文件名中包括 .zip 扩展名。 如果浏览导出文件，则向导会自动添加此文件扩展名。  

    -   如果不想导出任务序列依赖项，请清除“导出所有任务序列依赖项”复选框。 默认情况下，向导会扫描所有相关对象并与任务序列一起导出它们。 这包括应用程序的任何依赖项。  

    -   如果不想将包源中的内容复制到导出位置，请清除“导出所选任务序列和依赖项的所有内容”复选框。 如果选中此复选框，则导入任务序列向导使用导入路径作为新包源位置。  

    -   在“管理员备注”框中，添加要导出的任务序列的描述。  

6.  完成向导。  

 该向导会创建以下输出文件：  

-   如果不导出内容，则为一个 .zip 文件。  

-   如果导出内容，则为一个 .zip 文件和一个名为 *export*_files 的文件夹，其中 *export* 是包含导出内容的 .zip 文件的名称。  

 如果导出任务序列时包括内容，请确保复制 .zip 文件和 export_files 文件夹，否则导入将失败。  

#### <a name="to-import-task-sequences"></a>导入任务序列  

1.  在 Configuration Manager 控制台中，单击“软件库”。  

2.  在“软件库”工作区中，展开“操作系统”，然后单击“任务序列”。  

3.  在“主页”选项卡上的“创建”组中，单击“导入任务序列”，以启动导入任务序列向导。  

4.  在“常规”页上，指定导出的 .zip 文件，然后单击“下一步”。  

5.  在“文件内容”页上，为要导入的每个对象选择所需的操作。 此页显示已找到的 Configuration Manager 要导入的所有对象。  

    -   如果从未导入对象，请选择“新建”。  

    -   如果以前导入过对象，请选择下列操作之一：  

        -   忽略重复项（默认值）：此操作不导入对象。 而是由向导将现有对象链接到任务序列。  

        -   覆盖：此操作用导入的对象覆盖现有对象。 对于应用程序，你可以添加修订以更新现有应用程序或创建新应用程序。  

6.  完成向导。  

 导入任务序列之后，请编辑任务序列以指定原始任务序列中的任何密码。 出于安全原因，不会导出密码。  

##  <a name="BKMK_CreateTSVariables"></a>为计算机和集合创建任务序列变量  
可以为计算机和集合定义自定义的任务序列变量。 为计算机定义的变量称为特定于计算机的任务序列变量。 为集合定义的变量称为特定于集合的任务序列变量。 如果有冲突，特定于计算机的变量优先于特定于集合的变量。 此行为意味着，分配到特定计算机的任务序列变量会自动获得比分配到包含该计算机的集合的变量更高的优先级。  

例如，集合 ABC 获分配一个变量，而作为集合 ABC 的成员的计算机 XYZ 获分配一个同名的变量，那么，分配到计算机 XYZ 的变量具有比分配到集合 ABC 的变量更高的优先级。  

可以隐藏特定于计算机和特定于集合的变量，以便它们在 Configuration Manager 控制台中不可见。 如果不想再隐藏这些变量，则必须删除它们，然后，在不选中隐藏这些变量的选项的情况下重新定义它们。 使用选项“不要在 Configuration Manager 控制台中显示此值”时，控制台中不显示该变量的值。 但在变量运行时，任务序列仍可使用该变量。  

> [!WARNING]    
> “不要在 Configuration Manager 控制台中显示此值”设置仅适用于 Configuration Manager 控制台。 变量的值仍会显示在任务序列日志文件 (SMSTS.LOG) 中。 

可以在主站点或管理中心站点上管理因计算机而异的变量。 Configuration Manager 不支持一台计算机具有 1,000 个以上的已分配变量。  

> [!IMPORTANT]  
>  将特定于集合的变量用于任务序列时，请注意以下行为：  
>   
> - 对集合的更改始终会复制到整个层次结构。 对集合变量所做的任何更改不仅应用于当前站点的成员，还会应用于整个层次结构中该集合的所有成员。  
> - 删除集合时，此操作还会删除为集合配置的任务序列变量。  

 使用下列过程为计算机或集合创建任务序列变量。  

#### <a name="to-create-task-sequence-variables-for-a-computer"></a>为计算机创建任务序列变量  

1.  在 Configuration Manager 控制台中，单击“资产和符合性”。  

2.  在“资产和符合性”工作区中，展开包含你要添加变量的计算机的集合。  

3.  选择计算机，然后单击“属性”。  

4.  在“属性”对话框中，单击“变量”选项卡。  

5.  对于要创建的每个变量，请单击“<新建\> 变量”对话框中的“新建”图标。 指定任务序列变量的名称和值。 若要隐藏变量使其在 Configuration Manager 控制台中不可见，请取消选中“不在 Configuration Manager 控制台中显示此值”复选框。  

6.  将所有变量添加到计算机之后，单击“确定”。  

#### <a name="to-create-task-sequence-variables-for-a-collection"></a>为集合创建任务序列变量  

1.  在 Configuration Manager 控制台中，单击“资产和符合性”。  

2.  在“资产和符合性”工作区中，选择你要添加变量的集合，然后单击“属性”。  

3.  在“属性”对话框中，单击“集合变量”选项卡。  

4.  对于要创建的每个变量，请单击“<新建\> 变量”对话框中的“新建”图标。 指定任务序列变量的名称和值。 若要隐藏变量使其在 Configuration Manager 控制台中不可见，请取消选中“不在 Configuration Manager 控制台中显示此值”复选框。  

5.  根据需要为 Configuration Manager 指定要在评估任务序列变量时使用的优先级。  

6.  将所有变量添加到集合之后，单击“确定”。  

## <a name="add-child-task-sequences-to-a-task-sequence"></a>将子任务序列添加到任务序列

从 Configuration Manager 版本 1710 开始，可以添加运行另一个任务序列的新任务序列步骤。 此步骤将创建任务序列之间的父子关系。 使用此步骤可创建更多可重复使用的模块式任务序列。

将子任务序列添加到任务序列时，请考虑以下事项：

 - 父和子任务序列有效地组合成客户端运行的单个策略。
 - 该环境是全局环境。 例如，如果变量由父任务序列设置，然后由子任务序列更改，则该变量将保持更改。 类似地，如果子任务序列创建了一个新变量，则该变量可用于父任务序列中的其余步骤。
 - 对于单个任务序列操作，状态消息均按正常发送。
 - 任务序列将条目写入 smsts.log 文件，包括在子任务序列启动时使其清晰明确的新日志条目。

### <a name="to-add-a-child-task-sequence-to-a-task-sequence"></a>将子任务序列添加到任务序列

1. 在任务序列编辑器中，单击“添加”，选择“常规”，然后单击“运行任务序列”。
2. 单击“浏览”，选择子任务序列。  

##  <a name="BKMK_AdditionalActionsTS"></a>用于管理任务序列的其他操作  
 选择任务序列时，可以使用其他操作来管理任务序列。  

#### <a name="to-select-a-task-sequence-to-manage"></a>选择要管理的任务序列  

1.  在 Configuration Manager 控制台中，单击“软件库”。  

2.  在“软件库”工作区中，展开“操作系统”，然后单击“任务序列”。  

3.  在“任务序列”列表中，选择要管理的任务序列，然后选择可用的选项之一。  

 使用下表以了解有关其他一些用于管理任务序列的操作的详细信息。  

|操作|说明|  
|------------|-----------------|  
|**复制**|为所选的任务序列创建副本。 在根据现有任务序列创建新的任务序列时，此操作很有用。<br /><br /> 为某个文件夹中的任务序列创建副本时，副本会在该文件夹中列出，直至你刷新任务序列节点为止。 刷新后，副本将出现在根文件夹中。|  
|**禁用**|禁用任务序列，以便它无法在计算机上运行。 可以部署禁用的任务序列，但在启用该任务序列前，计算机不会运行它。|  
|**启用**|启用任务序列，以便可以运行它。 在启用已部署的任务序列后，无需重新部署它。|  
|**创建预留的内容文件**|启动“创建预留的内容文件向导”以预留任务序列内容。 有关如何创建预留的内容文件的信息，请参阅[预安排内容](../../core/servers/deploy/configure/deploy-and-manage-content.md#bkmk_prestage)。|  
|**移动**|将所选的任务序列移动到另一个文件夹。|  

## <a name="next-steps"></a>后续步骤
[部署企业版操作系统的方案](scenarios-to-deploy-enterprise-operating-systems.md)
